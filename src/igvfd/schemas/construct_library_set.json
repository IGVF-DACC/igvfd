{
    "title": "Construct Library Set",
    "$id": "/profiles/construct_library_set.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "description": "A file set containing raw data files resulting from sequencing of the library delivered to the sample. For example, a guide RNA library.",
    "type": "object",
    "required": [
        "award",
        "lab",
        "file_set_type",
        "selection_criteria",
        "scope"
    ],
    "identifyingProperties": [
        "uuid",
        "aliases",
        "accession",
        "alternate_accessions"
    ],
    "additionalProperties": false,
    "mixinProperties": [
        {
            "$ref": "mixins.json#/basic_item"
        },
        {
            "$ref": "mixins.json#/accession"
        },
        {
            "$ref": "mixins.json#/attribution"
        },
        {
            "$ref": "mixins.json#/product_info"
        },
        {
            "$ref": "mixins.json#/documents"
        },
        {
            "$ref": "mixins.json#/publication_identifiers"
        },
        {
            "$ref": "mixins.json#/release_timestamp"
        },
        {
            "$ref": "mixins.json#/genes"
        },
        {
            "$ref": "mixins.json#/loci"
        }
    ],
    "dependentSchemas": {
        "$merge": [
            "file_set.json#/dependentSchemas",
            "shared_dependencies.json#/accession_status"
        ],
        "integrated_content_files": {
            "comment": "Integrated content files must be tabular or reference files.",
            "if": {
                "properties": {
                    "integrated_content_files": {
                        "not": {
                            "items": {
                                "anyOf": [
                                    {
                                        "linkTo": "TabularFile"
                                    },
                                    {
                                        "linkTo": "ReferenceFile"
                                    }
                                ]
                            }
                        }
                    }
                }
            },
            "then": {
                "properties": {
                    "integrated_content_files": {
                        "permission": "import_items"
                    }
                }
            }
        },
        "file_set_type": {
            "comment": "Guide libraries require guide_type and should not specify any insert properties, reporter libraries require that scope be genome-wide or loci and should not specify any guide properties, expression vector libraries require genes, small_scale_gene_list, or large_scale_gene_list and that scope be genes, tile, or exon and should not specify any guide properties.",
            "allOf": [
                {
                    "if": {
                        "properties": {
                            "file_set_type": {
                                "const": "guide library"
                            }
                        }
                    },
                    "then": {
                        "required": [
                            "guide_type"
                        ],
                        "not": {
                            "anyOf": [
                                {
                                    "required": [
                                        "average_insert_size"
                                    ]
                                },
                                {
                                    "required": [
                                        "lower_bound_insert_size"
                                    ]
                                },
                                {
                                    "required": [
                                        "upper_bound_insert_size"
                                    ]
                                }
                            ]
                        }
                    }
                },
                {
                    "if": {
                        "properties": {
                            "file_set_type": {
                                "const": "reporter library"
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "scope": {
                                "enum": [
                                    "genome-wide",
                                    "loci"
                                ]
                            }
                        },
                        "not": {
                            "anyOf": [
                                {
                                    "required": [
                                        "guide_type"
                                    ]
                                },
                                {
                                    "required": [
                                        "tiling_modality"
                                    ]
                                },
                                {
                                    "required": [
                                        "average_guide_coverage"
                                    ]
                                },
                                {
                                    "required": [
                                        "lower_bound_guide_coverage"
                                    ]
                                },
                                {
                                    "required": [
                                        "upper_bound_guide_coverage"
                                    ]
                                }
                            ]
                        }
                    }
                },
                {
                    "if": {
                        "properties": {
                            "file_set_type": {
                                "const": "expression vector library"
                            }
                        }
                    },
                    "then": {
                        "oneOf": [
                            {
                                "required": [
                                    "genes"
                                ],
                                "properties": {
                                    "scope": {
                                        "oneOf": [
                                            {
                                                "const": "tile"
                                            },
                                            {
                                                "const": "exon"
                                            },
                                            {
                                                "const": "genes"
                                            },
                                            {
                                                "const": "interactors"
                                            }
                                        ]
                                    }
                                },
                                "not": {
                                    "anyOf": [
                                        {
                                            "required": [
                                                "guide_type"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "tiling_modality"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "average_guide_coverage"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "lower_bound_guide_coverage"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "upper_bound_guide_coverage"
                                            ]
                                        }
                                    ]
                                }
                            },
                            {
                                "required": [
                                    "small_scale_gene_list"
                                ],
                                "properties": {
                                    "scope": {
                                        "oneOf": [
                                            {
                                                "const": "tile"
                                            },
                                            {
                                                "const": "exon"
                                            },
                                            {
                                                "const": "genes"
                                            },
                                            {
                                                "const": "interactors"
                                            }
                                        ]
                                    }
                                },
                                "not": {
                                    "anyOf": [
                                        {
                                            "required": [
                                                "guide_type"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "tiling_modality"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "average_guide_coverage"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "lower_bound_guide_coverage"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "upper_bound_guide_coverage"
                                            ]
                                        }
                                    ]
                                }
                            },
                            {
                                "required": [
                                    "large_scale_gene_list"
                                ],
                                "properties": {
                                    "scope": {
                                        "const": "genes"
                                    }
                                },
                                "not": {
                                    "anyOf": [
                                        {
                                            "required": [
                                                "guide_type"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "tiling_modality"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "average_guide_coverage"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "lower_bound_guide_coverage"
                                            ]
                                        },
                                        {
                                            "required": [
                                                "upper_bound_guide_coverage"
                                            ]
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                }
            ]
        },
        "scope": {
            "comment": "If scope is genes then small_scale_gene_list or large_scale_gene_list is required, if scope is tile then both tile and small_scale_gene_list are required, if scope is loci then small_scale_loci_list or large_scale_loci_list are required, if scope is exon then both exon and small_scale_gene_list are required, if scope is genome-wide then tile, exon, small_scale_gene_list, large_scale_gene_list, small_scale_loci_list, and large_scale_loci_list shouldn't be specified.",
            "oneOf": [
                {
                    "required": [
                        "small_scale_gene_list"
                    ],
                    "properties": {
                        "scope": {
                            "enum": [
                                "genes"
                            ]
                        }
                    }
                },
                {
                    "required": [
                        "tile",
                        "small_scale_gene_list"
                    ],
                    "properties": {
                        "scope": {
                            "enum": [
                                "tile"
                            ]
                        }
                    }
                },
                {
                    "required": [
                        "exon",
                        "small_scale_gene_list"
                    ],
                    "properties": {
                        "scope": {
                            "enum": [
                                "exon"
                            ]
                        }
                    }
                },
                {
                    "required": [
                        "large_scale_gene_list"
                    ],
                    "properties": {
                        "scope": {
                            "enum": [
                                "genes"
                            ]
                        }
                    }
                },
                {
                    "required": [
                        "small_scale_loci_list"
                    ],
                    "properties": {
                        "scope": {
                            "enum": [
                                "loci"
                            ]
                        }
                    }
                },
                {
                    "required": [
                        "large_scale_loci_list"
                    ],
                    "properties": {
                        "scope": {
                            "enum": [
                                "loci"
                            ]
                        }
                    }
                },
                {
                    "required": [
                        "orf_list"
                    ],
                    "properties": {
                        "scope": {
                            "enum": [
                                "interactors"
                            ]
                        }
                    }
                },
                {
                    "not": {
                        "required": [
                            "tile",
                            "exon",
                            "small_scale_gene_list",
                            "large_scale_gene_list",
                            "small_scale_loci_list",
                            "large_scale_loci_list",
                            "orf_list"
                        ]
                    },
                    "properties": {
                        "scope": {
                            "enum": [
                                "genome-wide"
                            ]
                        }
                    }
                }
            ]
        },
        "small_scale_gene_list": {
            "comment": "Specification of small_scale_gene_list requires that scope is tile, exon, or genes and is mutually exclusive with specification of large_scale_gene_list.",
            "allOf": [
                {
                    "properties": {
                        "scope": {
                            "oneOf": [
                                {
                                    "const": "tile"
                                },
                                {
                                    "const": "exon"
                                },
                                {
                                    "const": "genes"
                                }
                            ]
                        }
                    }
                },
                {
                    "not": {
                        "required": [
                            "large_scale_gene_list"
                        ]
                    }
                }
            ]
        },
        "large_scale_gene_list": {
            "comment": "Specification of large_scale_gene_list requires that scope is genes and is mutually exclusive with specification of small_scale_gene_list.",
            "allOf": [
                {
                    "properties": {
                        "scope": {
                            "const": "genes"
                        }
                    }
                },
                {
                    "not": {
                        "required": [
                            "small_scale_gene_list",
                            "exon",
                            "tile"
                        ]
                    }
                }
            ]
        },
        "small_scale_loci_list": {
            "comment": "Specification of small_scale_loci_list requires that scope is loci and is mutually exclusive with specification of large_scale_loci_list.",
            "allOf": [
                {
                    "properties": {
                        "scope": {
                            "const": "loci"
                        }
                    }
                },
                {
                    "not": {
                        "required": [
                            "loci",
                            "large_scale_loci_list"
                        ]
                    }
                }
            ]
        },
        "large_scale_loci_list": {
            "comment": "Specification of large_scale_loci_list requires that scope is loci and is mutually exclusive with specification of small_scale_loci_list.",
            "allOf": [
                {
                    "properties": {
                        "scope": {
                            "const": "loci"
                        }
                    }
                },
                {
                    "not": {
                        "required": [
                            "small_scale_loci_list"
                        ]
                    }
                }
            ]
        },
        "exon": {
            "comment": "Specification of exon requires small_scale_gene_list and that scope is exon.",
            "required": [
                "small_scale_gene_list"
            ],
            "properties": {
                "scope": {
                    "enum": [
                        "exon"
                    ]
                }
            }
        },
        "tile": {
            "comment": "Specification of tile requires small_scale_gene_list and that scope is tile.",
            "required": [
                "small_scale_gene_list"
            ],
            "properties": {
                "scope": {
                    "enum": [
                        "tile"
                    ]
                }
            }
        },
        "orf_list": {
            "comment": "Specification of orf_list requires that scope is interactors.",
            "properties": {
                "scope": {
                    "enum": [
                        "interactors"
                    ]
                }
            }
        },
        "average_insert_size": {
            "comment": "Specification of average_insert_size is mutually exclusive with specification of lower_bound_insert_size and upper_bound_insert_size.",
            "not": {
                "required": [
                    "lower_bound_insert_size",
                    "upper_bound_insert_size"
                ]
            }
        },
        "lower_bound_insert_size": {
            "comment": "Specification of lower_bound_insert_size is mutually exclusive with specification of average_insert_size.",
            "not": {
                "required": [
                    "average_insert_size"
                ]
            },
            "required": [
                "upper_bound_insert_size"
            ]
        },
        "upper_bound_insert_size": {
            "comment": "Specification of upper_bound_insert_size is mutually exclusive with specification of average_insert_size.",
            "not": {
                "required": [
                    "average_insert_size"
                ]
            },
            "required": [
                "lower_bound_insert_size"
            ]
        },
        "average_guide_coverage": {
            "comment": "Specification of average_guide_coverage is mutually exclusive with specification of upper_bound_guide_coverage and lower_bound_guide_coverage.",
            "not": {
                "required": [
                    "upper_bound_guide_coverage",
                    "lower_bound_guide_coverage"
                ]
            }
        },
        "lower_bound_guide_coverage": {
            "comment": "Specification of lower_bound_guide_coverage is mutually exclusive with specification of average_guide_coverage.",
            "not": {
                "required": [
                    "average_guide_coverage"
                ]
            },
            "required": [
                "upper_bound_guide_coverage"
            ]
        },
        "upper_bound_guide_coverage": {
            "comment": "Specification of upper_bound_guide_coverage is mutually exclusive with specification of average_guide_coverage.",
            "not": {
                "required": [
                    "average_guide_coverage"
                ]
            },
            "required": [
                "lower_bound_guide_coverage"
            ]
        }
    },
    "properties": {
        "schema_version": {
            "default": "8"
        },
        "accession": {
            "accessionType": "DS"
        },
        "file_set_type": {
            "$merge": "file_set.json#/properties/file_set_type",
            "description": "The type or category of this construct library set.",
            "comment": "File set type describes the content of the construct library set. Guide libraries are guides used for CRISPR screens. Reporter libraries are reporters used for MPRA. Expression vector libraries are used when the content of the vector (a specific gene, exon, or tile of a protein) will be expressed in the target cells.",
            "enum": [
                "guide library",
                "reporter library",
                "expression vector library"
            ],
            "submissionExample": {
                "appscript": "guide library",
                "igvf_utils": "guide library"
            }
        },
        "scope": {
            "title": "Library Construct Scope",
            "description": "The scope or scale that this construct library is designed to target. If the scope is across gene(s) or loci, these will need to be specified in the genes or loci property. If exon is specified, an exon identifier and the associated gene will need to be listed in exon and genes properties. If tile is specified, a tile identifier, start and stop coordinates, and the associated gene will need to be listed in tile and small_scale_gene_list or large_scale_gene_list properties.",
            "type": "string",
            "enum": [
                "tile",
                "exon",
                "genes",
                "loci",
                "genome-wide",
                "interactors"
            ],
            "submissionExample": {
                "appscript": "genes",
                "igvf_utils": "genes"
            }
        },
        "selection_criteria": {
            "title": "Selection Criteria",
            "description": "The criteria used to select the sequence material cloned into the library.",
            "type": "array",
            "minItems": 1,
            "uniqueItems": true,
            "items": {
                "title": "Selection Criterion",
                "description": "The criterion used to select or design the sequence material cloned into the library.",
                "comment": "A construct library of phenotype-associated variants must list at least one disease or phenotype in the associated_phenotypes property.",
                "type": "string",
                "enum": [
                    "accessible genome regions",
                    "candidate cis-regulatory elements",
                    "chromatin states",
                    "phenotype-associated variants",
                    "DNase hypersensitive sites",
                    "genes",
                    "histone modifications",
                    "protein interactors",
                    "sequence variants",
                    "synthetic elements",
                    "transcription start sites",
                    "TF binding sites"
                ]
            },
            "submissionExample": {
                "appscript": "[\"accessible genome regions\", \"chromatin states\"]",
                "igvf_utils": "accessible genome regions, chromatin states"
            }
        },
        "integrated_content_files": {
            "title": "Integrated Content Files",
            "description": "The files containing sequence material of interest either used for insert design or directly cloned into vectors in this library.",
            "type": "array",
            "minItems": 1,
            "uniqueItems": true,
            "items": {
                "title": "Integrated Content File",
                "type": "string",
                "linkTo": "File",
                "comment": "See file.json for a list of available identifiers."
            },
            "submissionExample": {
                "appscript": "[\"john-done:file01\", \"IGVFFI6665ABCD\"]",
                "igvf_utils": "john-done:file01, IGVFFI6665ABCD"
            }
        },
        "associated_phenotypes": {
            "title": "Associated Phenotypes",
            "description": "Ontological terms for diseases or phenotypes associated with the sequence material cloned in this construct library.",
            "type": "array",
            "minItems": 1,
            "uniqueItems": true,
            "items": {
                "title": "Associated Phenotype",
                "comment": "See phenotype_term.json for a list of available identifiers.",
                "type": "string",
                "linkTo": "PhenotypeTerm"
            },
            "submissionExample": {
                "appscript": "[\"/phenotype-terms/MONDO_0008564/\", \"/phenotype-terms/MONDO_0005148/\"]",
                "igvf_utils": "/phenotype-terms/MONDO_0008564/, /phenotype-terms/MONDO_0005148/"
            }
        },
        "orf_list": {
            "title": "List of Open Reading Frames (ORF).",
            "description": "List of Open Reading Frame this construct library was designed to target.",
            "type": "array",
            "uniqueItems": true,
            "minItems": 1,
            "items": {
                "title": "List of Open Reading Frames (ORF).",
                "description": "List of Open Reading Frame this construct library was designed to target.",
                "linkTo": "OpenReadingFrame",
                "type": "string"
            },
            "submissionExample": {
                "appscript": "[\"/open-reading-frame/CCSBORF1234/\", \"/open-reading-frame/CCSBORF5678/\", \"CCSBORF9876\"]",
                "igvf_utils": "/open-reading-frame/CCSBORF1234/, /open-reading-frame/CCSBORF5678/, CCSBORF9876"
            }
        },
        "small_scale_gene_list": {
            "description": "The specific, small scale list of (<=100) gene(s) this construct library was designed to target.",
            "comment": "If more than 100 genes were targeted, submit large_scale_gene_list instead. For a guide library, guides should directly map to or target the gene(s) listed here. Genes are disallowed from submission in a reporter library."
        },
        "large_scale_gene_list": {
            "description": "The large scale list of (>100 genes) this construct library was designed to target.",
            "comment": "If 100 or fewer genes were targeted, submit small_scale_gene_list instead. For a guide library, guides should directly map to or target the gene(s) listed here. Genes are disallowed from submission in a reporter library."
        },
        "exon": {
            "title": "Exon",
            "description": "An identifier in plain text for the specific exon in an expression vector library. The associated gene must be listed in the small_scale_gene_list property.",
            "type": "string",
            "pattern": "^(\\S+(\\s|\\S)*\\S+|\\S)$",
            "submissionExample": {
                "appscript": "exon1",
                "igvf_utils": "exon1"
            }
        },
        "tile": {
            "title": "Tile",
            "description": "The coordinates and an identifier in plain text for the specific tile of a protein region cloned in an expression vector library. The associated gene for this protein must be listed in the small_scale_gene_list or large_scale_gene_list property.",
            "comment": "The protein tile locus is defined using 1-based numbering where 1 indicates the N-terminal Methionine initiator.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "tile_id": {
                    "title": "Tile ID",
                    "description": "An identifier in plain text for the specific tile of a protein region cloned in an expression vector library.",
                    "type": "string",
                    "pattern": "^(\\S+(\\s|\\S)*\\S+|\\S)$"
                },
                "tile_start": {
                    "title": "Tile Start",
                    "description": "The 1-based, closed (inclusive) starting coordinate.",
                    "type": "integer",
                    "minimum": 1
                },
                "tile_end": {
                    "title": "Tile End",
                    "description": "The 1-based, closed (inclusive) ending coordinate.",
                    "type": "integer",
                    "minimum": 1
                }
            },
            "submissionExample": {
                "appscript": "{\"tile_id\": \"tile1\", \"tile_start\": 1, \"tile_end\": 207}",
                "igvf_utils": "{\"tile_id\": \"tile1\", \"tile_start\": 1, \"tile_end\": 207}"
            }
        },
        "product_id": {
            "title": "Product ID",
            "description": "The product or catalog identifier provided following deposition to addgene.org.",
            "type": "string",
            "pattern": "^addgene:\\d{5,6}$",
            "submissionExample": {
                "appscript": "addgene:71489",
                "igvf_utils": "addgene:71489"
            }
        },
        "guide_type": {
            "title": "Guide Type",
            "description": "The design of guides used in a CRISPR library, paired-guide (pgRNA) or single-guide (sgRNA).",
            "type": "string",
            "enum": [
                "sgRNA",
                "pgRNA"
            ],
            "submissionExample": {
                "appscript": "sgRNA",
                "igvf_utils": "sgRNA"
            }
        },
        "tiling_modality": {
            "title": "Tiling Modality",
            "description": "The tiling modality of guides across elements or loci in a CRISPR library.",
            "comment": "Peak tiling = all possible gRNA in a selection of peaks. Full tiling = all possible gRNA across an entire locus, including regulatory elements and non regulatory elements. Sparse peaks = a small set of gRNA against a selection of peaks.",
            "type": "string",
            "enum": [
                "peak tiling",
                "full tiling",
                "sparse peaks"
            ],
            "submissionExample": {
                "appscript": "peak tiling",
                "igvf_utils": "peak tiling"
            }
        },
        "average_guide_coverage": {
            "title": "Average Guide Coverage",
            "description": "The average number of guides targeting each element of interest in the library.",
            "type": "number",
            "minimum": 0,
            "submissionExample": {
                "appscript": 223.23,
                "igvf_utils": 223.23
            }
        },
        "lower_bound_guide_coverage": {
            "title": "Lower Bound Guide Coverage",
            "description": "Lower bound of the number of guides targeting each element of interest in the library.",
            "type": "integer",
            "submissionExample": {
                "appscript": 34,
                "igvf_utils": 34
            }
        },
        "upper_bound_guide_coverage": {
            "title": "Upper Bound Guide Coverage",
            "description": "Upper bound of the number of guides targeting each element of interest in the library.",
            "type": "integer",
            "submissionExample": {
                "appscript": 434,
                "igvf_utils": 434
            }
        },
        "average_insert_size": {
            "title": "Average Insert Size",
            "description": "The average size of the inserts cloned into vectors in the library.",
            "type": "number",
            "minimum": 0,
            "submissionExample": {
                "appscript": 76.76,
                "igvf_utils": 76.76
            }
        },
        "lower_bound_insert_size": {
            "title": "Lower Bound Insert Size",
            "description": "Lower bound of the size of the inserts cloned in vectors in the library.",
            "type": "integer",
            "submissionExample": {
                "appscript": 26,
                "igvf_utils": 26
            }
        },
        "upper_bound_insert_size": {
            "title": "Upper Bound Insert Size",
            "description": "Upper bound of the size of the inserts cloned in vectors in the library.",
            "type": "integer",
            "submissionExample": {
                "appscript": 126,
                "igvf_utils": 126
            }
        }
    },
    "fuzzy_searchable_fields": [
        "@type",
        "collections",
        "selection_criteria",
        "small_scale_gene_list.symbol",
        "lab.title",
        "submitted_by.title"
    ],
    "exact_searchable_fields": [
        "control_for.accession",
        "control_for.aliases",
        "publication_identifiers",
        "lot_id",
        "product_id",
        "files.accession",
        "files.aliases"
    ],
    "changelog": "/profiles/changelogs/construct_library_set.md"
}
